{"ast":null,"code":"import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\nimport Agent from '../../App/Api/Agent';\nconst initialState = {\n  basket: null,\n  status: 'idle'\n};\nexport const addBasketItemAsync = createAsyncThunk('basket/addBasketItemAsync', async _ref => {\n  let {\n    productId,\n    quantity\n  } = _ref;\n\n  try {\n    return await Agent.Basket.addItem(productId, quantity);\n  } catch (error) {\n    console.log(error);\n  }\n});\nexport const BasketSlice = createSlice({\n  name: 'basket',\n  initialState,\n  reducers: {\n    setBasket: (state, action) => {\n      state.basket = action.payload;\n    },\n    removeItem: (state, action) => {\n      var _state$basket, _state$basket2;\n\n      const {\n        productId,\n        quantity\n      } = action.payload;\n      const itemIndex = (_state$basket = state.basket) === null || _state$basket === void 0 ? void 0 : _state$basket.items.findIndex(i => i.productId === productId);\n      if (itemIndex === -1 || itemIndex === undefined) return;\n      state.basket.items[itemIndex].quantity -= quantity;\n      if (((_state$basket2 = state.basket) === null || _state$basket2 === void 0 ? void 0 : _state$basket2.items[itemIndex].quantity) === 0) state.basket.items.splice(itemIndex, 1);\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(addBasketItemAsync.pending, (state, action) => {\n      console.log(action);\n      state.status = 'pendingAddItem';\n    });\n    builder.addCase(addBasketItemAsync.fulfilled, (state, action) => {\n      state.basket = action.payload;\n      state.status = 'idle';\n    });\n    builder.addCase(addBasketItemAsync.rejected, (state, action) => {\n      console.log(action);\n      state.status = 'pendingAddItem';\n    });\n  }\n});\nexport const {\n  setBasket,\n  removeItem\n} = BasketSlice.actions;","map":{"version":3,"names":["createAsyncThunk","createSlice","Agent","initialState","basket","status","addBasketItemAsync","productId","quantity","Basket","addItem","error","console","log","BasketSlice","name","reducers","setBasket","state","action","payload","removeItem","itemIndex","items","findIndex","i","undefined","splice","extraReducers","builder","addCase","pending","fulfilled","rejected","actions"],"sources":["D:/Project/client/src/Features/Basket/BasketSlice.ts"],"sourcesContent":["import { Product } from './../../App/Models/Product';\r\nimport { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\r\nimport { Basket } from \"../../App/Models/Basket\";\r\nimport Agent from '../../App/Api/Agent';\r\n\r\n\r\ninterface BasketState {\r\n    basket: Basket | null;\r\n    status: string;\r\n}\r\n\r\nconst initialState: BasketState = {\r\n    basket: null,\r\n    status: 'idle'\r\n}\r\n\r\nexport const addBasketItemAsync =\r\n    createAsyncThunk<Basket, { productId: number, quantity: number }>(\r\n        'basket/addBasketItemAsync',\r\n        async ({ productId, quantity }) => {\r\n            try {\r\n                return await Agent.Basket.addItem(productId, quantity);\r\n            } catch (error) {\r\n                console.log(error)\r\n            }\r\n        })\r\n\r\nexport const BasketSlice = createSlice({\r\n    name: 'basket',\r\n    initialState,\r\n    reducers: {\r\n        setBasket: (state, action) => {\r\n            state.basket = action.payload\r\n        },\r\n        removeItem: (state, action) => {\r\n            const { productId, quantity } = action.payload;\r\n            const itemIndex = state.basket?.items.findIndex(i => i.productId === productId);\r\n\r\n            if (itemIndex === -1 || itemIndex === undefined) return;\r\n            state.basket!.items[itemIndex].quantity -= quantity;\r\n\r\n            if (state.basket?.items[itemIndex].quantity === 0)\r\n                state.basket.items.splice(itemIndex, 1);\r\n        }\r\n    },\r\n    extraReducers: (builder) =>{\r\n        builder.addCase(addBasketItemAsync.pending, (state, action) =>{\r\n            console.log(action);\r\n            state.status='pendingAddItem'\r\n        });\r\n        builder.addCase(addBasketItemAsync.fulfilled, (state, action) =>{\r\n            state.basket = action.payload;\r\n            state.status='idle'\r\n        });\r\n        builder.addCase(addBasketItemAsync.rejected, (state, action) =>{\r\n            console.log(action);\r\n            state.status='pendingAddItem'\r\n        })\r\n    }\r\n})\r\n\r\nexport const { setBasket, removeItem } = BasketSlice.actions;"],"mappings":"AACA,SAASA,gBAAT,EAA2BC,WAA3B,QAA8C,kBAA9C;AAEA,OAAOC,KAAP,MAAkB,qBAAlB;AAQA,MAAMC,YAAyB,GAAG;EAC9BC,MAAM,EAAE,IADsB;EAE9BC,MAAM,EAAE;AAFsB,CAAlC;AAKA,OAAO,MAAMC,kBAAkB,GAC3BN,gBAAgB,CACZ,2BADY,EAEZ,cAAmC;EAAA,IAA5B;IAAEO,SAAF;IAAaC;EAAb,CAA4B;;EAC/B,IAAI;IACA,OAAO,MAAMN,KAAK,CAACO,MAAN,CAAaC,OAAb,CAAqBH,SAArB,EAAgCC,QAAhC,CAAb;EACH,CAFD,CAEE,OAAOG,KAAP,EAAc;IACZC,OAAO,CAACC,GAAR,CAAYF,KAAZ;EACH;AACJ,CARW,CADb;AAWP,OAAO,MAAMG,WAAW,GAAGb,WAAW,CAAC;EACnCc,IAAI,EAAE,QAD6B;EAEnCZ,YAFmC;EAGnCa,QAAQ,EAAE;IACNC,SAAS,EAAE,CAACC,KAAD,EAAQC,MAAR,KAAmB;MAC1BD,KAAK,CAACd,MAAN,GAAee,MAAM,CAACC,OAAtB;IACH,CAHK;IAINC,UAAU,EAAE,CAACH,KAAD,EAAQC,MAAR,KAAmB;MAAA;;MAC3B,MAAM;QAAEZ,SAAF;QAAaC;MAAb,IAA0BW,MAAM,CAACC,OAAvC;MACA,MAAME,SAAS,oBAAGJ,KAAK,CAACd,MAAT,kDAAG,cAAcmB,KAAd,CAAoBC,SAApB,CAA8BC,CAAC,IAAIA,CAAC,CAAClB,SAAF,KAAgBA,SAAnD,CAAlB;MAEA,IAAIe,SAAS,KAAK,CAAC,CAAf,IAAoBA,SAAS,KAAKI,SAAtC,EAAiD;MACjDR,KAAK,CAACd,MAAN,CAAcmB,KAAd,CAAoBD,SAApB,EAA+Bd,QAA/B,IAA2CA,QAA3C;MAEA,IAAI,mBAAAU,KAAK,CAACd,MAAN,kEAAcmB,KAAd,CAAoBD,SAApB,EAA+Bd,QAA/B,MAA4C,CAAhD,EACIU,KAAK,CAACd,MAAN,CAAamB,KAAb,CAAmBI,MAAnB,CAA0BL,SAA1B,EAAqC,CAArC;IACP;EAbK,CAHyB;EAkBnCM,aAAa,EAAGC,OAAD,IAAY;IACvBA,OAAO,CAACC,OAAR,CAAgBxB,kBAAkB,CAACyB,OAAnC,EAA4C,CAACb,KAAD,EAAQC,MAAR,KAAkB;MAC1DP,OAAO,CAACC,GAAR,CAAYM,MAAZ;MACAD,KAAK,CAACb,MAAN,GAAa,gBAAb;IACH,CAHD;IAIAwB,OAAO,CAACC,OAAR,CAAgBxB,kBAAkB,CAAC0B,SAAnC,EAA8C,CAACd,KAAD,EAAQC,MAAR,KAAkB;MAC5DD,KAAK,CAACd,MAAN,GAAee,MAAM,CAACC,OAAtB;MACAF,KAAK,CAACb,MAAN,GAAa,MAAb;IACH,CAHD;IAIAwB,OAAO,CAACC,OAAR,CAAgBxB,kBAAkB,CAAC2B,QAAnC,EAA6C,CAACf,KAAD,EAAQC,MAAR,KAAkB;MAC3DP,OAAO,CAACC,GAAR,CAAYM,MAAZ;MACAD,KAAK,CAACb,MAAN,GAAa,gBAAb;IACH,CAHD;EAIH;AA/BkC,CAAD,CAA/B;AAkCP,OAAO,MAAM;EAAEY,SAAF;EAAaI;AAAb,IAA4BP,WAAW,CAACoB,OAA9C"},"metadata":{},"sourceType":"module"}