{"ast":null,"code":"import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\nimport Agent from '../../App/Api/Agent';\nconst initialState = {\n  basket: null,\n  status: 'idle'\n};\nexport const addBasketItemAsync = createAsyncThunk('basket/addBasketItemAsync', async _ref => {\n  let {\n    productId,\n    quantity = 1\n  } = _ref;\n\n  try {\n    return await Agent.Basket.addItem(productId, quantity);\n  } catch (error) {\n    console.log(error);\n  }\n});\nexport const removeBasketItemAsync = createAsyncThunk('basket/removeBasketItemAsync', async _ref2 => {\n  let {\n    productId,\n    quantity = 1\n  } = _ref2;\n\n  try {\n    await Agent.Basket.removeItem(productId, quantity);\n  } catch (error) {\n    console.log(error);\n  }\n});\nexport const BasketSlice = createSlice({\n  name: 'basket',\n  initialState,\n  reducers: {\n    setBasket: (state, action) => {\n      state.basket = action.payload;\n    },\n    removeItem: (state, action) => {\n      var _state$basket, _state$basket2;\n\n      const {\n        productId,\n        quantity\n      } = action.payload;\n      const itemIndex = (_state$basket = state.basket) === null || _state$basket === void 0 ? void 0 : _state$basket.items.findIndex(i => i.productId === productId);\n      if (itemIndex === -1 || itemIndex === undefined) return;\n      state.basket.items[itemIndex].quantity -= quantity;\n      if (((_state$basket2 = state.basket) === null || _state$basket2 === void 0 ? void 0 : _state$basket2.items[itemIndex].quantity) === 0) state.basket.items.splice(itemIndex, 1);\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(addBasketItemAsync.pending, (state, action) => {\n      state.status = 'pendingAddItem' + action.meta.arg.productId;\n    });\n    builder.addCase(addBasketItemAsync.fulfilled, (state, action) => {\n      state.basket = action.payload;\n      state.status = 'idle';\n    });\n    builder.addCase(addBasketItemAsync.rejected, (state, action) => {\n      state.status = 'idle';\n    });\n    builder.addCase(removeBasketItemAsync.pending), (state, action) => {};\n  }\n});\nexport const {\n  setBasket,\n  removeItem\n} = BasketSlice.actions;","map":{"version":3,"names":["createAsyncThunk","createSlice","Agent","initialState","basket","status","addBasketItemAsync","productId","quantity","Basket","addItem","error","console","log","removeBasketItemAsync","removeItem","BasketSlice","name","reducers","setBasket","state","action","payload","itemIndex","items","findIndex","i","undefined","splice","extraReducers","builder","addCase","pending","meta","arg","fulfilled","rejected","actions"],"sources":["D:/Project/client/src/Features/Basket/BasketSlice.ts"],"sourcesContent":["import { Product } from './../../App/Models/Product';\r\nimport { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\r\nimport { Basket } from \"../../App/Models/Basket\";\r\nimport Agent from '../../App/Api/Agent';\r\n\r\n\r\ninterface BasketState {\r\n    basket: Basket | null;\r\n    status: string;\r\n}\r\n\r\nconst initialState: BasketState = {\r\n    basket: null,\r\n    status: 'idle'\r\n}\r\n\r\nexport const addBasketItemAsync =\r\n    createAsyncThunk<Basket, { productId: number, quantity?: number }>(\r\n        'basket/addBasketItemAsync',\r\n        async ({ productId, quantity = 1 }) => {\r\n            try {\r\n                return await Agent.Basket.addItem(productId, quantity);\r\n            } catch (error) {\r\n                console.log(error)\r\n            }\r\n        });\r\n\r\nexport const removeBasketItemAsync = createAsyncThunk<void, { productId: number, quantity?: number }>(\r\n    'basket/removeBasketItemAsync',\r\n    async ({ productId, quantity = 1 }) => {\r\n        try {\r\n            await Agent.Basket.removeItem(productId, quantity);\r\n        } catch (error) {\r\n            console.log(error)\r\n        }\r\n    });\r\n\r\nexport const BasketSlice = createSlice({\r\n    name: 'basket',\r\n    initialState,\r\n    reducers: {\r\n        setBasket: (state, action) => {\r\n            state.basket = action.payload\r\n        },\r\n        removeItem: (state, action) => {\r\n            const { productId, quantity } = action.payload;\r\n            const itemIndex = state.basket?.items.findIndex(i => i.productId === productId);\r\n\r\n            if (itemIndex === -1 || itemIndex === undefined) return;\r\n            state.basket!.items[itemIndex].quantity -= quantity;\r\n\r\n            if (state.basket?.items[itemIndex].quantity === 0)\r\n                state.basket.items.splice(itemIndex, 1);\r\n        }\r\n    },\r\n    extraReducers: (builder) => {\r\n        builder.addCase(addBasketItemAsync.pending, (state, action) => {\r\n            state.status = 'pendingAddItem' + action.meta.arg.productId;\r\n        });\r\n        builder.addCase(addBasketItemAsync.fulfilled, (state, action) => {\r\n            state.basket = action.payload;\r\n            state.status = 'idle'\r\n        });\r\n        builder.addCase(addBasketItemAsync.rejected, (state, action) => {\r\n            state.status = 'idle'\r\n        });\r\n        builder.addCase(removeBasketItemAsync.pending), (state, action)=> {\r\n\r\n }    }\r\n})\r\n\r\nexport const { setBasket, removeItem } = BasketSlice.actions;"],"mappings":"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"},"metadata":{},"sourceType":"module"}