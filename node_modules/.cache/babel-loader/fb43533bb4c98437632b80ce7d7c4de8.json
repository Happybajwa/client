{"ast":null,"code":"import { createAsyncThunk, createEntityAdapter, createSlice } from \"@reduxjs/toolkit\";\nimport Agent from \"../../App/Api/Agent\";\nconst productsAdapter = createEntityAdapter();\n\nfunction getAxiosParams(productParams) {\n  const params = new URLSearchParams();\n  params.append('pageNumber', productParams.pageNumber.toString());\n  params.append('pageSize', productParams.pageSize.toString());\n  params.append('orderBy', productParams.orderBy);\n  if (productParams.searchBy) params.append('searchBy', productParams.searchBy);\n  if (productParams.size) params.append('size', productParams.size.toString());\n  if (productParams.gender) params.append('gender', productParams.gender.toString());\n  return params;\n}\n\nexport const fetchProductsAsync = createAsyncThunk('catalog/fetchProductsAsync', async (_, thunkAPI) => {\n  const params = getAxiosParams(thunkAPI.getState().catalog.ProductParams);\n\n  try {\n    const response = await Agent.Catalog.list(params);\n    thunkAPI.dispatch(setPageData(response.pageData));\n    return response.items;\n  } catch (error) {\n    return thunkAPI.rejectWithValue({\n      error: error.data\n    });\n  }\n});\nexport const fetchProductAsync = createAsyncThunk('catalog/fetchProductAsync', async (productId, thunkAPI) => {\n  try {\n    return await Agent.Catalog.details(productId);\n  } catch (error) {\n    console.log(error);\n    return thunkAPI.rejectWithValue({\n      error: error.data\n    });\n  }\n});\nexport const fetchFilterAsync = createAsyncThunk('catalog/fetchFilterAsync', async (_, thunkAPI) => {\n  try {\n    return await Agent.Catalog.fetchFilters();\n  } catch (error) {\n    return thunkAPI.rejectWithValue({\n      error: error.data\n    });\n  }\n});\n\nfunction initParams() {\n  return {\n    pageNumber: 1,\n    pageSize: 6,\n    orderBy: 'name'\n  };\n}\n\nexport const catalogSlice = createSlice({\n  name: 'slice',\n  initialState: productsAdapter.getInitialState({\n    productsLoaded: false,\n    filtersLoaded: false,\n    status: 'idle',\n    gender: [],\n    size: [],\n    ProductParams: initParams(),\n    pageData: null\n  }),\n  reducers: {\n    setProductParams: (state, action) => {\n      state.productsLoaded = false;\n      state.ProductParams = { ...state.ProductParams,\n        ...action.payload,\n        pageNumber: 1\n      };\n    },\n    setPageNumber: (state, action) => {\n      state.productsLoaded = false;\n      state.ProductParams = { ...state.ProductParams,\n        ...action.payload\n      };\n    },\n    setPageData: (state, action) => {\n      state.pageData = action.payload;\n    },\n    resetProductParams: state => {\n      state.ProductParams = initParams();\n    },\n    setProduct: (state, action) => {\n      productsAdapter.ups;\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchProductsAsync.pending, state => {\n      state.status = 'pendingFetchProducts';\n    });\n    builder.addCase(fetchProductsAsync.fulfilled, (state, action) => {\n      productsAdapter.setAll(state, action.payload);\n      state.status = 'idle';\n      state.productsLoaded = true;\n    });\n    builder.addCase(fetchProductsAsync.rejected, state => {\n      state.status = 'idle';\n    }); ///loading single product\n\n    builder.addCase(fetchProductAsync.pending, state => {\n      state.status = 'pendingFetchProduct';\n    });\n    builder.addCase(fetchProductAsync.fulfilled, (state, action) => {\n      productsAdapter.upsertOne(state, action.payload);\n      state.status = 'idle';\n    });\n    builder.addCase(fetchProductAsync.rejected, (state, action) => {\n      state.status = 'idle';\n    }); //Loading Filters\n\n    builder.addCase(fetchFilterAsync.pending, state => {\n      state.status = 'pendingFetchFilters';\n    });\n    builder.addCase(fetchFilterAsync.fulfilled, (state, action) => {\n      state.gender = action.payload.gender;\n      state.size = action.payload.size;\n      state.filtersLoaded = true;\n    });\n    builder.addCase(fetchFilterAsync.rejected, (state, action) => {\n      state.status = 'idle';\n      console.log(action.payload);\n    });\n  }\n});\nexport const productSelectors = productsAdapter.getSelectors(state => state.catalog);\nexport const {\n  setProductParams,\n  resetProductParams,\n  setPageData,\n  setPageNumber\n} = catalogSlice.actions;","map":{"version":3,"names":["createAsyncThunk","createEntityAdapter","createSlice","Agent","productsAdapter","getAxiosParams","productParams","params","URLSearchParams","append","pageNumber","toString","pageSize","orderBy","searchBy","size","gender","fetchProductsAsync","_","thunkAPI","getState","catalog","ProductParams","response","Catalog","list","dispatch","setPageData","pageData","items","error","rejectWithValue","data","fetchProductAsync","productId","details","console","log","fetchFilterAsync","fetchFilters","initParams","catalogSlice","name","initialState","getInitialState","productsLoaded","filtersLoaded","status","reducers","setProductParams","state","action","payload","setPageNumber","resetProductParams","setProduct","ups","extraReducers","builder","addCase","pending","fulfilled","setAll","rejected","upsertOne","productSelectors","getSelectors","actions"],"sources":["D:/Project/client/src/Features/Catalog/CatalogSlice.ts"],"sourcesContent":["import { PageData } from './../../App/Models/pagination';\r\nimport { ProductParams } from './../../App/Models/Product';\r\nimport { RootState } from './../../App/Store/ConfigureStore';\r\nimport { createAsyncThunk, createEntityAdapter, createSlice } from \"@reduxjs/toolkit\";\r\nimport Agent from \"../../App/Api/Agent\";\r\nimport { Product} from \"../../App/Models/Product\";\r\n\r\n\r\ninterface CatalogState {\r\n    productsLoaded:boolean;\r\n    filtersLoaded:boolean;\r\n    status:string;\r\n    gender:string[];\r\n    size:string[];\r\n    ProductParams:ProductParams;\r\n    pageData:PageData | null;\r\n}\r\n\r\nconst productsAdapter = createEntityAdapter<Product>();\r\n\r\nfunction getAxiosParams(productParams:ProductParams)\r\n{\r\n    const params = new URLSearchParams();\r\n    params.append('pageNumber', productParams.pageNumber.toString());\r\n    params.append('pageSize', productParams.pageSize.toString());\r\n    params.append('orderBy', productParams.orderBy);\r\n\r\n    if(productParams.searchBy) \r\n        params.append('searchBy', productParams.searchBy);\r\n    if(productParams.size) \r\n        params.append('size', productParams.size.toString());\r\n    if(productParams.gender) \r\n        params.append('gender', productParams.gender.toString());\r\n    return params;\r\n}\r\n\r\nexport const fetchProductsAsync = createAsyncThunk<Product[], void, {state:RootState}>(\r\n    'catalog/fetchProductsAsync',\r\n    async (_, thunkAPI) => {\r\n        const params = getAxiosParams(thunkAPI.getState().catalog.ProductParams);\r\n        try {\r\n            const response = await Agent.Catalog.list(params);\r\n            thunkAPI.dispatch(setPageData(response.pageData));\r\n            return response.items;\r\n        } catch (error: any) {\r\n            return thunkAPI.rejectWithValue({ error: error.data })\r\n        }\r\n    }\r\n)\r\n\r\nexport const fetchProductAsync = createAsyncThunk<Product, number>(\r\n    'catalog/fetchProductAsync',\r\n    async (productId, thunkAPI) => {\r\n        try {\r\n            return await Agent.Catalog.details(productId);\r\n        } catch (error: any) {\r\n            console.log(error)\r\n            return thunkAPI.rejectWithValue({ error: error.data })\r\n        }\r\n    }\r\n)\r\n\r\nexport const fetchFilterAsync = createAsyncThunk(\r\n    'catalog/fetchFilterAsync',\r\n    async (_, thunkAPI) => {\r\n        try {\r\n            return await Agent.Catalog.fetchFilters();\r\n        } catch (error: any) {\r\n            return thunkAPI.rejectWithValue({ error: error.data })\r\n        }\r\n    }\r\n)\r\n\r\nfunction initParams()\r\n{\r\n    return {\r\n        pageNumber:1,\r\n        pageSize:6,\r\n        orderBy:'name'\r\n    }\r\n}\r\n\r\nexport const catalogSlice = createSlice({\r\n    name: 'slice',\r\n    initialState: productsAdapter.getInitialState<CatalogState>({\r\n        productsLoaded: false,\r\n        filtersLoaded: false,\r\n        status: 'idle',\r\n        gender: [],\r\n        size: [],\r\n        ProductParams: initParams(),\r\n        pageData: null\r\n    }),\r\n    reducers: {\r\n        setProductParams:(state, action) => {\r\n            state.productsLoaded = false;\r\n            state.ProductParams = {...state.ProductParams, ...action.payload, pageNumber: 1};\r\n        },\r\n        setPageNumber:(state,action) =>{\r\n            state.productsLoaded = false;\r\n            state.ProductParams = {...state.ProductParams, ...action.payload};\r\n        },\r\n        setPageData:(state, action) => {\r\n            state.pageData = action.payload;\r\n        },\r\n        resetProductParams: (state) => {\r\n            state.ProductParams = initParams();\r\n        },\r\n        setProduct:(state, action) => {\r\n            productsAdapter.ups\r\n        }\r\n    },\r\n    extraReducers: (builder) => {\r\n        builder.addCase(fetchProductsAsync.pending, (state) => {\r\n            state.status = 'pendingFetchProducts';\r\n        });\r\n        builder.addCase(fetchProductsAsync.fulfilled, (state, action) => {\r\n            productsAdapter.setAll(state, action.payload);\r\n            state.status = 'idle';\r\n            state.productsLoaded = true;\r\n        });\r\n        builder.addCase(fetchProductsAsync.rejected, (state) => {\r\n            state.status = 'idle';\r\n        })\r\n        ///loading single product\r\n\r\n        builder.addCase(fetchProductAsync.pending, (state) => {\r\n            state.status = 'pendingFetchProduct';\r\n        })\r\n        builder.addCase(fetchProductAsync.fulfilled, (state, action) => {\r\n            productsAdapter.upsertOne(state, action.payload);\r\n            state.status = 'idle';\r\n        })\r\n        builder.addCase(fetchProductAsync.rejected, (state, action) => {\r\n            state.status = 'idle';\r\n        })\r\n        //Loading Filters\r\n        builder.addCase(fetchFilterAsync.pending, (state) => {\r\n            state.status = 'pendingFetchFilters';\r\n        })\r\n        builder.addCase(fetchFilterAsync.fulfilled, (state, action) => {\r\n            state.gender = action.payload.gender;\r\n            state.size = action.payload.size;\r\n            state.filtersLoaded = true;\r\n        })\r\n        builder.addCase(fetchFilterAsync.rejected, (state, action) => {\r\n            state.status = 'idle';\r\n            console.log(action.payload)\r\n        })\r\n    }\r\n})\r\n\r\nexport const productSelectors = productsAdapter.getSelectors((state: RootState) => state.catalog);\r\n\r\nexport const {setProductParams, resetProductParams, setPageData, setPageNumber} = catalogSlice.actions;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}